# Fate-Engine 功能清单（可视化）

> 基于 `bazi_calculator.py` 源码分析
> 生成时间: 2025-12-16

---

## 📊 功能总览

```
┌─────────────────────────────────────────────────────────────────────┐
│                    Fate-Engine 测算功能架构                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌────────────┐ │
│  │  核心八字   │  │  运势系统   │  │  传统命理   │  │ 专业扩展   │ │
│  │  (25字段)   │  │  (12字段)   │  │  (14字段)   │  │ (27字段)   │ │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └─────┬──────┘ │
│         │                │                │               │        │
│         └────────────────┴────────────────┴───────────────┘        │
│                                  │                                  │
│                          ┌──────┴──────┐                           │
│                          │  总计 78+   │                           │
│                          │  功能字段   │                           │
│                          └─────────────┘                           │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 一、核心八字功能 (25字段)

### 1.1 四柱排盘

```
┌────────────────────────────────────────────────────────────┐
│                      四柱排盘系统                           │
├──────────┬──────────┬──────────┬──────────┬────────────────┤
│   年柱   │   月柱   │   日柱   │   时柱   │    计算方法    │
├──────────┼──────────┼──────────┼──────────┼────────────────┤
│ 天干     │ 天干     │ 天干     │ 天干     │ lunar-python   │
│ 地支     │ 地支     │ 地支     │ 地支     │ getYearGan()   │
│ 纳音     │ 纳音     │ 纳音     │ 纳音     │ LunarUtil.NAYIN│
│ 五行     │ 五行     │ 五行     │ 五行     │ STEM_ELEM      │
└──────────┴──────────┴──────────┴──────────┴────────────────┘
```

| 字段 | 输出键名 | 数据来源 | 说明 |
|------|---------|---------|------|
| 四柱 | `fourPillars` | `ec.getYear/Month/Day/Time()` | 年月日时干支 |
| 藏干 | `hiddenStems` | `ec.getXxxHideGan()` | 地支藏干 |
| 十神 | `tenGods` | `ec.getXxxShiShenGan/Zhi()` | 天干地支十神 |
| 十二长生 | `twelveGrowth` | `ec.getXxxDiShi()` | 长生/沐浴/冠带等 |
| 五行统计 | `fiveElements` | `_calc_elements()` | 木火土金水数量+百分比 |

### 1.2 日主分析

```
┌─────────────────────────────────────────┐
│              日主分析                    │
├─────────────┬───────────────────────────┤
│ 日主天干    │ ec.getDayGan()            │
│ 日主五行    │ STEM_ELEM[日干]           │
│ 阴阳属性    │ 天干序号 % 2              │
│ 强弱判断    │ _calc_strength()          │
│ 自坐长生    │ _calc_self_sitting()      │
└─────────────┴───────────────────────────┘
```

| 字段 | 输出键名 | 计算方法 |
|------|---------|---------|
| 日主信息 | `dayMaster` | 日干+五行+阴阳+强弱+自坐 |
| 五行状态 | `wuxingState` | `_calc_wuxing_state()` 旺相休囚死 |

### 1.3 特殊宫位

```
┌─────────────────────────────────────────┐
│            特殊宫位 (4宫)                │
├─────────────┬───────────────────────────┤
│ 胎元        │ ec.getTaiYuan()           │
│ 胎息        │ ec.getTaiXi()             │
│ 命宫        │ ec.getMingGong()          │
│ 身宫        │ ec.getShenGong()          │
└─────────────┴───────────────────────────┘
```

| 字段 | 输出键名 | 说明 |
|------|---------|------|
| 特殊宫位 | `specialPalaces` | 胎元/胎息/命宫/身宫+纳音 |
| 空亡信息 | `voidInfo` | 四柱旬空 `ec.getXxxXunKong()` |

### 1.4 神煞系统 (21种)

```
┌─────────────────────────────────────────────────────────────┐
│                    神煞系统 (21种)                           │
├───────────────────┬───────────────────┬─────────────────────┤
│      吉神 (15)    │     凶煞 (7)      │     特殊 (5)        │
├───────────────────┼───────────────────┼─────────────────────┤
│ 天乙贵人          │ 羊刃              │ 驿马                │
│ 太极贵人          │ 劫煞              │ 桃花                │
│ 天德贵人          │ 亡神              │ 华盖                │
│ 月德贵人          │ 红艳煞            │ 孤辰                │
│ 国印贵人          │ 十恶大败          │ 寡宿                │
│ 文昌贵人          │ 勾煞              │                     │
│ 将星              │ 绞煞              │                     │
│ 学堂              │                   │                     │
│ 德秀贵人          │                   │                     │
│ 天德合            │                   │                     │
│ 禄神              │                   │                     │
│ 金舆              │                   │                     │
│ 天医              │                   │                     │
│ 月德合            │                   │                     │
│ 词馆              │                   │                     │
└───────────────────┴───────────────────┴─────────────────────┘
```

| 字段 | 输出键名 | 计算方法 |
|------|---------|---------|
| 神煞 | `spirits` | `_calc_spirits(ec)` 按柱分类 |

### 1.5 格局用神

```
┌─────────────────────────────────────────┐
│           格局系统 (10种)                │
├─────────────────────────────────────────┤
│ 建禄格 │ 羊刃格 │ 正官格 │ 七杀格       │
│ 正财格 │ 偏财格 │ 正印格 │ 偏印格       │
│ 食神格 │ 伤官格 │                       │
└─────────────────────────────────────────┘
```

| 字段 | 输出键名 | 计算方法 |
|------|---------|---------|
| 格局 | `geju` | `_calc_geju()` 月令透干判断 |
| 用神 | `yongShen` | `_calc_yongshen()` 调候用神表 |

### 1.6 干支关系

```
┌─────────────────────────────────────────────────────────────┐
│                    干支关系分析                              │
├─────────────────────────────────────────────────────────────┤
│  天干: 合(甲己/乙庚/丙辛/丁壬/戊癸) + 冲(甲庚/乙辛/丙壬/丁癸)│
│  地支: 六合 + 三合 + 半合 + 六冲 + 三刑 + 六害 + 相破       │
└─────────────────────────────────────────────────────────────┘
```

| 字段 | 输出键名 | 计算方法 |
|------|---------|---------|
| 干支关系 | `ganzhiRelations` | `_calc_ganzhi_relations()` |

---

## 二、运势系统 (12字段)

### 2.1 大运流年

```
┌─────────────────────────────────────────────────────────────┐
│                      运势系统                                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐  │
│  │  大运   │───▶│  流年   │───▶│  流月   │───▶│  小运   │  │
│  │ 10年/步│    │ 1年/步  │    │ 1月/步  │    │ 1年/步  │  │
│  └─────────┘    └─────────┘    └─────────┘    └─────────┘  │
│       │              │              │              │        │
│       ▼              ▼              ▼              ▼        │
│   9步大运       92年流年       1104流月        92小运      │
│   (3-93岁)     (出生-92年)    (全量)         (0-91岁)     │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

| 字段 | 输出键名 | 计算方法 | 数据量 |
|------|---------|---------|--------|
| 大运 | `majorFortune` | `_calc_fortune(yun)` | 9步 |
| 流年 | `annualFortune` | `_calc_annual()` | 92年 |
| 流月 | `monthlyFortune` | `_calc_monthly(yun)` | 1104月 |
| 小运 | `xiaoYun` | `_calc_xiao_yun(yun)` | 92年 |
| 交运 | `jiaoYun` | `_calc_jiao_yun(yun)` | 起运时间 |

### 2.2 节气司令

| 字段 | 输出键名 | 计算方法 |
|------|---------|---------|
| 节气详情 | `jieqiDetail` | `_calc_jieqi_detail()` |
| 人元司令 | `siling` | `_calc_siling()` |

---

## 三、传统命理功能 (14字段)

### 3.1 称骨命卦

```
┌─────────────────────────────────────────┐
│           称骨算命 + 命卦                │
├─────────────────────────────────────────┤
│ 称骨: 年+月+日+时 骨重 → 评语           │
│ 命卦: 出生年份 → 八宅命卦               │
└─────────────────────────────────────────┘
```

| 字段 | 输出键名 | 计算方法 |
|------|---------|---------|
| 称骨 | `boneWeight` | `calc_bone_weight()` |
| 命卦 | `mingGua` | `calc_ming_gua()` |

### 3.2 占卜系统

```
┌─────────────────────────────────────────────────────────────┐
│                    占卜系统 (6种)                            │
├─────────────┬─────────────┬─────────────┬───────────────────┤
│   六爻      │   梅花易数  │   奇门遁甲  │     大六壬        │
├─────────────┼─────────────┼─────────────┼───────────────────┤
│ liuyao.py   │ meihua.py   │ qimen.py    │ liuren.py         │
│ 当前时间    │ 当前时间    │ 当前时间    │ 四柱数据          │
│ 起卦        │ 起卦        │ 排盘        │ 排盘              │
└─────────────┴─────────────┴─────────────┴───────────────────┘
```

| 字段 | 输出键名 | 模块 | 说明 |
|------|---------|------|------|
| 六爻 | `liuyaoHexagram` | `liuyao.py` | 本卦/变卦/动爻 |
| 梅花 | `meihuaYishu` | `meihua.py` | 上下卦/体用/互卦 |
| 数字起卦 | `numberDivination` | `meihua.py` | 五行分析 |
| 奇门 | `qimenDunjia` | `qimen.py` | 局数/九星/八门 |
| 八门 | `mysticalGates` | `qimen.py` | 八门详情 |
| 六壬 | `liurenDivination` | `liuren.py` | 四课三传 |

### 3.3 紫微斗数

| 字段 | 输出键名 | 模块 | 说明 |
|------|---------|------|------|
| 紫微基础 | `ziweiBasic` | `ziwei.py` | 命宫/十二宫 |

### 3.4 择日历法

| 字段 | 输出键名 | 模块 | 说明 |
|------|---------|------|------|
| 择日 | `dateSelection` | `zeri.py` | 30天内吉日 |
| 吉日列表 | `auspiciousDates` | `zeri.py` | 推荐日期 |

### 3.5 易经系统

| 字段 | 输出键名 | 模块 | 说明 |
|------|---------|------|------|
| 卦象 | `hexagrams` | `enhanced_yijing_integration.py` | 多重起卦 |
| 易经分析 | `yijingAnalysis` | `enhanced_yijing_integration.py` | 完整分析 |
| 占卜 | `divination` | `enhanced_yijing_integration.py` | 哲学分析 |

### 3.6 待输入功能

| 字段 | 输出键名 | 模块 | 状态 |
|------|---------|------|------|
| 合婚 | `marriageCompatibility` | `hehun.py` | 需配偶八字 |
| 八字配对 | `baziMatching` | `hehun.py` | 需配偶八字 |
| 姓名分析 | `nameAnalysis` | `xingming.py` | 需姓名输入 |
| 五格 | `fiveGrids` | `xingming.py` | 需姓名输入 |
| 笔画 | `strokeAnalysis` | `xingming.py` | 需姓名输入 |

---

## 四、专业扩展功能 (27字段)

### 4.1 寿星万年历

```
┌─────────────────────────────────────────┐
│         寿星万年历 (sxwnl)              │
├─────────────────────────────────────────┤
│ 模块: sxwnl_integration.py              │
│ 依赖: libs/external/github/sxwnl-master │
│ 语言: Node.js                           │
└─────────────────────────────────────────┘
```

| 字段 | 输出键名 | 说明 |
|------|---------|------|
| 历法 | `sxwnlCalendar` | 高精度历法 |
| 精度 | `highPrecisionTime` | 天文级时间 |
| 天文 | `astronomicalData` | 天文数据 |

### 4.2 专业紫微斗数

```
┌─────────────────────────────────────────┐
│       专业紫微斗数 (fortel)             │
├─────────────────────────────────────────┤
│ 模块: fortel_ziwei_integration.py       │
│ 依赖: fortel-ziweidoushu-main (TS)      │
│      iztro-main (TS)                    │
└─────────────────────────────────────────┘
```

| 字段 | 输出键名 | 说明 |
|------|---------|------|
| 星盘 | `ziweiChart` | 完整星盘 |
| 星位 | `starPositions` | 星曜位置 |
| 宫位 | `palaceAnalysis` | 十二宫分析 |
| 星曜 | `starInfluence` | 星曜影响 |

### 4.3 风水罗盘

```
┌─────────────────────────────────────────┐
│        风水罗盘 (mikaboshi)             │
├─────────────────────────────────────────┤
│ 模块: mikaboshi_fengshui_integration.py │
│ 依赖: mikaboshi-main (Rust)             │
└─────────────────────────────────────────┘
```

| 字段 | 输出键名 | 说明 |
|------|---------|------|
| 罗盘 | `fengshuiCompass` | 风水罗盘 |
| 方位 | `directionAnalysis` | 方位分析 |
| 九星 | `nineStars` | 九星飞布 |
| 八卦 | `bagua` | 八卦方位 |

### 4.4 天文占星

```
┌─────────────────────────────────────────┐
│         天文占星 (astro)                │
├─────────────────────────────────────────┤
│ 模块: astro_integration.py              │
│ 依赖: js_astro-master (JS)              │
└─────────────────────────────────────────┘
```

| 字段 | 输出键名 | 说明 |
|------|---------|------|
| 行星 | `planetPositions` | 行星位置 |
| 星座 | `zodiacSigns` | 黄道星座 |
| 相位 | `aspects` | 行星相位 |
| 宫位 | `houses` | 宫位系统 |

### 4.5 现代化八字

```
┌─────────────────────────────────────────┐
│       现代化八字 (dantalion)            │
├─────────────────────────────────────────┤
│ 模块: dantalion_integration.py          │
│ 依赖: dantalion-master (TS)             │
└─────────────────────────────────────────┘
```

| 字段 | 输出键名 | 说明 |
|------|---------|------|
| 现代八字 | `modernBazi` | 现代化模型 |
| TS模型 | `typeScriptModel` | TypeScript接口 |
| API | `apiInterface` | API接口 |

### 4.6 高级历法

| 字段 | 输出键名 | 模块 | 说明 |
|------|---------|------|------|
| 多历法 | `multiCalendar` | `advanced_calendar_integration.py` | 多种历法 |
| 节假日 | `holidays` | `advanced_calendar_integration.py` | 节假日 |
| 节日 | `festivals` | `advanced_calendar_integration.py` | 传统节日 |

### 4.7 系统优化

| 字段 | 输出键名 | 模块 | 说明 |
|------|---------|------|------|
| 性能 | `performance` | `system_optimization.py` | 性能指标 |
| 缓存 | `caching` | `system_optimization.py` | 缓存状态 |
| 优化 | `optimization` | `system_optimization.py` | 优化级别 |

### 4.8 真太阳时

| 字段 | 输出键名 | 模块 | 说明 |
|------|---------|------|------|
| 完整真太阳时 | `completeTrueSolarTime` | `true_solar_time.py` | 详细计算 |
| 子时分析 | `ziTimeAnalysis` | `true_solar_time.py` | 早晚子时 |

---

## 五、其他信息字段

### 5.1 出生信息

| 字段 | 输出键名 | 说明 |
|------|---------|------|
| 出生信息 | `birthInfo` | 公历/农历/生肖/星座/星宿 |
| 黄历 | `huangLi` | 宜忌 |
| 真太阳时 | `trueSolarTime` | 修正后时间 |

### 5.2 输入参数

| 字段 | 输出键名 | 说明 |
|------|---------|------|
| 输入 | `input` | 用户输入参数 |
| 元数据 | `meta` | 计算时间/性别 |

---

## 六、模块依赖关系图

```
┌─────────────────────────────────────────────────────────────────────┐
│                        模块依赖关系                                  │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  bazi_calculator.py (主入口)                                        │
│         │                                                           │
│         ├──▶ lunar-python (核心依赖)                                │
│         │         └── Solar, Lunar, EightChar, LunarUtil            │
│         │                                                           │
│         ├──▶ 本地模块                                               │
│         │    ├── sxwnl_integration.py ──▶ sxwnl-master (Node.js)   │
│         │    ├── fortel_ziwei_integration.py ──▶ iztro (TS)        │
│         │    ├── mikaboshi_fengshui_integration.py ──▶ Rust        │
│         │    ├── astro_integration.py ──▶ js_astro (JS)            │
│         │    ├── dantalion_integration.py ──▶ dantalion (TS)       │
│         │    ├── advanced_calendar_integration.py                   │
│         │    ├── enhanced_yijing_integration.py                     │
│         │    ├── meihua.py                                          │
│         │    ├── liuyao.py                                          │
│         │    ├── liuren.py                                          │
│         │    ├── qimen.py                                           │
│         │    ├── ziwei.py                                           │
│         │    ├── zeri.py                                            │
│         │    ├── hehun.py                                           │
│         │    ├── xingming.py                                        │
│         │    ├── true_solar_time.py                                 │
│         │    └── system_optimization.py                             │
│         │                                                           │
│         └──▶ 外部库 (libs/external/github/)                         │
│              ├── lunar-python-master (Python)                       │
│              ├── bazi-1-master (Python)                             │
│              ├── sxwnl-master (Node.js)                             │
│              ├── iztro-main (TypeScript)                            │
│              ├── fortel-ziweidoushu-main (TypeScript)               │
│              ├── mikaboshi-main (Rust)                              │
│              ├── js_astro-master (JavaScript)                       │
│              ├── dantalion-master (TypeScript)                      │
│              ├── Chinese-Divination-master (Python)                 │
│              ├── Iching-master (TypeScript)                         │
│              └── bazi-name-master (TypeScript)                      │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 七、字段统计

| 类别 | 字段数 | 状态 |
|------|--------|------|
| 核心八字 | 25 | ✅ 完整 |
| 运势系统 | 12 | ✅ 完整 |
| 传统命理 | 14 | ⚠️ 3个待输入 |
| 专业扩展 | 27 | ✅ 完整 |
| **总计** | **78** | |

---

## 八、计算方法速查表

| 功能 | 方法名 | 数据来源 |
|------|--------|---------|
| 四柱 | `_pillar()` | `ec.getYear/Month/Day/Time()` |
| 藏干 | 直接调用 | `ec.getXxxHideGan()` |
| 十神 | 直接调用 | `ec.getXxxShiShenGan/Zhi()` |
| 十二长生 | 直接调用 | `ec.getXxxDiShi()` |
| 五行统计 | `_calc_elements()` | 遍历四柱+藏干 |
| 神煞 | `_calc_spirits()` | lunar-python内置 |
| 日主强弱 | `_calc_strength()` | 五行生克计算 |
| 干支关系 | `_calc_ganzhi_relations()` | 合冲刑害破表 |
| 五行状态 | `_calc_wuxing_state()` | `WUXING_STATE`表 |
| 人元司令 | `_calc_siling()` | `SILING`表 |
| 格局 | `_calc_geju()` | 月令透干判断 |
| 用神 | `_calc_yongshen()` | `TIAOHOU`调候表 |
| 大运 | `_calc_fortune()` | `yun.getDaYun()` |
| 流年 | `_calc_annual()` | 循环生成92年 |
| 流月 | `_calc_monthly()` | 大运内流月 |
| 小运 | `_calc_xiao_yun()` | `yun.getXiaoYun()` |
| 交运 | `_calc_jiao_yun()` | `yun.getStartSolar()` |
| 节气 | `_calc_jieqi_detail()` | `lunar.getPrev/NextJieQi()` |
| 真太阳时 | `_calc_true_solar_time()` | 经度修正+均时差 |
| 空亡 | `_calc_all_void()` | `ec.getXxxXunKong()` |
| 自坐 | `_calc_self_sitting()` | 十二长生表 |
| 称骨 | `calc_bone_weight()` | `BONE_*`表 |
| 命卦 | `calc_ming_gua()` | 年份计算 |
| 黄历 | `_calc_huangli()` | `lunar.getDayYi/Ji()` |
