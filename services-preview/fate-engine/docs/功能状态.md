# 功能状态（计算/呈现开关）

> 目的：明确“计算是否执行”与“TXT 是否展示”的边界，避免口径混乱与信息过载。
>
> 原则：**不删代码、不降级计算**；仅通过开关控制 TXT 中是否展示某些模块。

## 总原则

- 计算层：按开关决定是否执行（外部库单一口径；失败即报错；关闭的模块不计算也不要求依赖）
- 呈现层：按开关决定是否在 TXT 中展示
- 开关位置：
  - 默认开关：`services/telegram-service/src/report_generator.py` → `DEFAULT_HIDE`
  - Bot/API 计算传参：`services/telegram-service/src/bazi_calculator.py` → `calculate(hide=...)`

## 默认开关（生产默认）

| 模块/板块 | TXT 是否展示 | 说明 |
|---|---:|---|
| 基本信息、四柱排盘、日主概览、五行能量、格局用神、节气司令、干支关系 | 开启 | 八字主线（先天命格） |
| 五行停匀与寒湿燥热（调候依据） | 开启 | 仅输出 bazi-1 口径结果（温湿度分数/调候喜忌等），不做自写结论 |
| 干支取象（原文） | 开启 | 直接输出 bazi-1 `gan_desc`/`zhi_desc` 原文 |
| 紫微斗数、紫微基础 | 开启 | 作为“第二卷：紫微映象” |
| 紫微运限四化（大限/流年/流月/流日/流时） | 开启 | 直接输出 iztro `horoscope()` 原生结果（含四化与流耀） |
| 运势分析（大运+流年） | 开启（全量） | 禁止切片；仅通过表格压缩呈现 |
| 流月运势 | 开启（全量） | 禁止切片；仅通过表格压缩呈现 |
| 小运 | 开启 | 逐条展开 |
| 袁天罡称骨 | 开启 | 民俗板块 |
| 健康预警（五行脏腑/养生提示） | 关闭 | 默认不生成（可开） |
| 建除十二神 | 开启 | 作为“严谨性校验”，与真太阳时/节气同属基础信息 |
| 出生日黄历 | 关闭 | 与个人命格主线弱相关，默认隐藏（可开） |
| 择日推荐 | 关闭 | 专项服务，默认隐藏（可开） |
| 六爻/梅花/数字起卦/奇门/大六壬 | 关闭 | 即时占卜/独立体系，默认不混入命盘报告（可开） |
| 易经系统-数字起卦 | 关闭 | 与占卜重叠，默认隐藏（可开） |
| 风水九星 | 关闭 | 体系并列，默认隐藏（可开） |
| 天文占星 | 关闭 | 技术参数层，默认隐藏（可开） |
| 高级历法 | 关闭 | 技术参数层，默认隐藏（可开） |
| 易经系统 | 关闭 | 默认隐藏（可开） |
| 姓名合婚模块 | 关闭 | 单人报告默认隐藏（可开） |
| 系统附录 | 关闭 | 开发者技术备注默认隐藏（可开） |

## 近期输出范围（避免信息爆炸）

- 禁止切片：`RECENT_YEARS = None`
- 禁止切片：`generate_monthly_section(..., recent_years=None)`

## 修改指引（只改呈现，不动计算）

1. 打开 `services/telegram-service/src/report_generator.py`
2. 修改 `generate_full_report()` 内：
   - `HIDE[...] = True/False` 控制模块展示
   - `RECENT_YEARS` 控制“近期流年”范围
   - `generate_monthly_section(..., recent_years=...)` 控制“近期流月”范围
