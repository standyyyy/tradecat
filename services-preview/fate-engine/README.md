# Fate-Engine

> ä¸“ä¸šçº§å…«å­—æ’ç›˜ç³»ç»Ÿ | åŠŸèƒ½æœ€å®Œæ•´çš„å¼€æºå‘½ç†å¼•æ“

[![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)](https://python.org)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.104+-green.svg)](https://fastapi.tiangolo.com)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![å®Œæˆåº¦](https://img.shields.io/badge/å®Œæˆåº¦-100%25-brightgreen.svg)](#åŠŸèƒ½å®Œæˆåº¦)

## ğŸ¯ é¡¹ç›®ç®€ä»‹

Fate-Engine æ˜¯åŸºäºä¼ ç»Ÿå‘½ç†å­¦çš„ä¸“ä¸šå…«å­—æ’ç›˜ç³»ç»Ÿï¼Œé‡‡ç”¨ç¡®å®šæ€§ç®—æ³•é©±åŠ¨ï¼Œè¾“å‡ºç»“æ„åŒ– JSON æ•°æ®ã€‚

### âœ¨ æ ¸å¿ƒç‰¹è‰²

- ğŸ”® **66 ä¸ªå­—æ®µå…¨é‡è®¡ç®—**ï¼šæ ¸å¿ƒ 25 + æ‰©å±• 41ï¼Œç®—æ³•æ— é˜‰å‰²ã€‚
- ğŸ§¾ **åŒæŠ¥å‘Šäº§ç‰©**ï¼šå¸¸è§„ç‰ˆ TXT + `-aiåˆ†æç‰ˆ`ï¼ˆè‡ªåŠ¨æ‹¼æ¥ prompts/å®Œæ•´ç‰ˆ.mdï¼‰ï¼Œä¾¿äºä¸€é”®å¤åˆ¶åˆ° AIã€‚
- ğŸŒŸ **21 ç§ç¥ç… / 10 ç§æ ¼å±€**ï¼šä¸šç•Œè¦†ç›–æœ€å…¨ã€‚
- ğŸ›°ï¸ **çœŸå¤ªé˜³æ—¶ + 3199 åœ°ç‚¹æ¨¡ç³ŠåŒ¹é…**ï¼šæœªå‘½ä¸­åœ°å€ç›´æ¥é€€å›ä¸»èœå•ã€‚
- ğŸ¤– **Telegram Bot è‡ªæ„ˆ**ï¼šå‘é€/åª’ä½“ç»„é‡è¯•ï¼Œå¥åº·æ£€æŸ¥ 3 æ¬¡å¤±è´¥è‡ªåŠ¨é€€å‡ºï¼Œç”±å¤–å±‚ `run_with_retry` å¤æ´»ã€‚
- ğŸš€ **FastAPI æœåŠ¡**ï¼šåŒä¸€ä»£ç åŸºçº¿ï¼ŒæŒ‰éœ€å¯åŠ¨ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.10+
- Node.js 18+ (å¯¿æ˜Ÿä¸‡å¹´å†æ”¯æŒ)
- Rust 1.70+ (é£æ°´ç½—ç›˜æ”¯æŒ)
- è™šæ‹Ÿç¯å¢ƒ

### å®‰è£…è¿è¡Œ

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd fate-engine

# æ­å»ºå¤–éƒ¨ç¯å¢ƒ (æ–°å¢)
chmod +x setup_external_env.sh
./setup_external_env.sh

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate

# å®‰è£…ä¾èµ–
cd services/telegram-service
pip install -r requirements.txt

# å¯åŠ¨æœåŠ¡ï¼ˆç”Ÿäº§åŸºçº¿ï¼‰
python start.py bot    # Telegram Botï¼ˆé»˜è®¤ï¼‰
# æˆ– python start.py api / both

# äº§ç‰©ç›®å½•
# services/telegram-service/output/txt/ ä¸‹ç”Ÿæˆ <æ—¥æœŸ-æ—¶é—´-åœ°ç‚¹-å§“å-æ€§åˆ«>.txt ä¸åŒå -aiåˆ†æç‰ˆ.txt
```

### ç¯å¢ƒé…ç½®

```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆä»“åº“å¤–ï¼Œé¿å…æ³„éœ²ï¼‰
mkdir -p ~/.projects/fate-engine-env
echo "TELEGRAM_BOT_TOKEN=your_token_here" > ~/.projects/fate-engine-env/.env
```

### è¿è¡Œäº§ç‰©
- è¯´æ˜æ¶ˆæ¯ï¼šåˆ—å‡ºä¸¤ä»½æ–‡ä»¶åçš„ Markdown ä»£ç å— + AI é“¾æ¥ + ã€ŒğŸ² é‡æ–°æ’ç›˜ã€æŒ‰é’®ã€‚
- é™„ä»¶ï¼šåŒå TXT ä¸ `-aiåˆ†æç‰ˆ.txt` ä½œä¸º media group å‘é€ã€‚
- è½ç›˜ï¼š`services/telegram-service/output/txt/`ã€‚

---

## ğŸ“‹ åŠŸèƒ½å®Œæˆåº¦

### âœ… æ ¸å¿ƒå…«å­—åŠŸèƒ½ (100%)

| æ¨¡å— | å­—æ®µ | åŠŸèƒ½ |
|------|------|------|
| åŸºç¡€å››æŸ± | `fourPillars` | å¹´æœˆæ—¥æ—¶å¹²æ”¯+çº³éŸ³+äº”è¡Œ |
| è—å¹²åç¥ | `hiddenStems`, `tenGods` | åœ°æ”¯è—å¹²+å¤©å¹²åœ°æ”¯åç¥ |
| é•¿ç”Ÿäº”è¡Œ | `twelveGrowth`, `fiveElements` | åäºŒé•¿ç”Ÿ+äº”è¡Œç»Ÿè®¡ |
| äº”è¡ŒçŠ¶æ€ | `wuxingState` | æ—ºç›¸ä¼‘å›šæ­»çŠ¶æ€ |
| ç‰¹æ®Šå®«ä½ | `specialPalaces` | èƒå…ƒ/èƒæ¯/å‘½å®«/èº«å®« |
| ç©ºäº¡ä¿¡æ¯ | `voidInfo` | å››æŸ±æ—¬ç©ºè¯¦æƒ… |
| **ç¥ç…ç³»ç»Ÿ** | `spirits` | **21ç§ç¥ç…** |
| æ—¥ä¸»åˆ†æ | `dayMaster` | æ—¥ä¸»+å¼ºå¼±+è‡ªå |
| å¹²æ”¯å…³ç³» | `ganzhiRelations` | å¤©å¹²åˆå†²+åœ°æ”¯å…³ç³» |
| å¤§è¿æµå¹´ | `majorFortune`, `annualFortune` | å¤§è¿æµå¹´+åç¥ |
| æµæœˆå°è¿ | `monthlyFortune`, `xiaoYun` | æµæœˆ+å°è¿ |
| **ç§°éª¨å‘½å¦** | `boneWeight`, `mingGua` | ç§°éª¨+å…«å®…å‘½å¦ |
| å‡ºç”Ÿä¿¡æ¯ | `birthInfo` | å…¬å†å†œå†+ç”Ÿè‚–æ˜Ÿåº§ |
| èŠ‚æ°”å¸ä»¤ | `jieqiDetail`, `siling` | èŠ‚æ°”+äººå…ƒå¸ä»¤ |
| **æ ¼å±€ç”¨ç¥** | `geju`, `yongShen` | 10ç§æ ¼å±€+ç”¨ç¥ |
| äº¤è¿é»„å† | `jiaoYun`, `huangLi` | äº¤è¿+é»„å†å®œå¿Œ |

### âœ… æ‰©å±•åŠŸèƒ½ (80%)

- ğŸ¤ **åˆå©šç®—æ³•** (`hehun.py`) - å…«å­—åˆå©šåŒ¹é…
- ğŸ“ **å§“åå­¦** (`xingming.py`) - äº”æ ¼å‰–è±¡æ³•
- ğŸ¯ **å…­çˆ»å åœ** (`liuyao.py`) - å…­çˆ»èµ·å¦è§£å¦
- ğŸŒ¸ **æ¢…èŠ±æ˜“æ•°** (`meihua.py`) - æ¢…èŠ±æ˜“æ•°å åœ
- ğŸ“… **æ‹©æ—¥ç®—æ³•** (`zeri.py`) - æ‹©å‰æ—¥ç®—æ³•

---

## ğŸ”§ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **è¯­è¨€**: Python 3.10+
- **æ ¸å¿ƒåº“**: lunar-python (ä¸“ä¸šå†æ³•)
- **APIæ¡†æ¶**: FastAPI + Pydantic
- **Botæ¡†æ¶**: python-telegram-bot
- **æ•°æ®åº“**: SQLite
- **åœ°ç‚¹æ•°æ®**: 3199æ¡çœå¸‚åŒºå¿ç»çº¬åº¦
- **å¥å£®æ€§**: å‘é€/åª’ä½“ç»„å¸¦é‡è¯•ï¼›å¥åº·æ£€æŸ¥æ¯ 60s è°ƒç”¨ `bot.get_me`ï¼Œå¤±è´¥ 3 æ¬¡é€€å‡ºï¼Œå¤–å±‚ `run_with_retry` è‡ªåŠ¨é‡è¿ã€‚

### é¡¹ç›®ç»“æ„
```
fate-engine/
â”œâ”€â”€ services/telegram-service/        # ç”Ÿäº§è¿è¡Œçš„ Bot/API
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ bot.py                    # Telegram å…¥å£ + è‡ªæ„ˆ
â”‚   â”‚   â”œâ”€â”€ bazi_calculator.py        # æ ¸å¿ƒè®¡ç®—
â”‚   â”‚   â”œâ”€â”€ report_generator.py       # æŠ¥å‘Šæ¸²æŸ“ï¼ˆé»˜è®¤éšè—æ‹©æ—¥/ç³»ç»Ÿ/å§“ååˆå©šï¼‰
â”‚   â”‚   â”œâ”€â”€ location.py               # åœ°ç‚¹æ¨¡ç³ŠåŒ¹é…
â”‚   â”‚   â”œâ”€â”€ prompts/å®Œæ•´ç‰ˆ.md         # AI åˆ†æç‰ˆæç¤ºè¯
â”‚   â”‚   â””â”€â”€ *_integration.py          # 8 ä¸ªä¸“ä¸šæ‰©å±•
â”‚   â”œâ”€â”€ output/
â”‚   â”‚   â”œâ”€â”€ txt/                      # æŠ¥å‘Šï¼šå¸¸è§„ + -aiåˆ†æç‰ˆ
â”‚   â”‚   â””â”€â”€ logs/bot.log              # è½®è½¬æ—¥å¿—
â”‚   â””â”€â”€ start.py                      # å¯åŠ¨å…¥å£ (bot/api/both)
â”œâ”€â”€ libs/
â”‚   â”œâ”€â”€ data/china_coordinates.csv    # åœ°ç‚¹æ•°æ®
â”‚   â”œâ”€â”€ database/bazi/bazi.db         # SQLite
â”‚   â””â”€â”€ external/github/              # 55 ä¸ªåŸç”Ÿå‘½ç†åº“ï¼ˆåªè¯»ï¼‰
â””â”€â”€ docs/                             # æ–‡æ¡£
```

---

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### Python API è°ƒç”¨

```python
from bazi_calculator import BaziCalculator
from datetime import datetime

# åˆ›å»ºè®¡ç®—å™¨
calc = BaziCalculator(
    birth_dt=datetime(1990, 5, 15, 14, 30),
    gender="male",
    longitude=114.1  # æ·±åœ³
)

# æ‰§è¡Œè®¡ç®—
result = calc.calculate()

# è¾“å‡ºç»“æœ (66ä¸ªåŠŸèƒ½å­—æ®µ)
print(f"å››æŸ±: {result['fourPillars']}")
print(f"ç¥ç…: {result['spirits']}")
print(f"æ ¼å±€: {result['geju']}")
print(f"ç´«å¾®: {result['ziweiChart']}")  # ä¸“ä¸šæ‰©å±•
print(f"é£æ°´: {result['fengshuiCompass']}")  # ä¸“ä¸šæ‰©å±•
```

### Telegram Bot ä½¿ç”¨

```
è¾“å…¥: 1990-05-15 14:30 æ·±åœ³ å¼ ä¸‰
é€‰æ‹©: â™‚ ä¹¾é€ (ç”·)
è¾“å‡º: å®Œæ•´66å­—æ®µæ’ç›˜ç»“æœ
```

### FastAPI æ¥å£

```bash
curl -X POST "http://localhost:8001/api/v1/bazi/calculate" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "å¼ ä¸‰",
    "gender": "male", 
    "birthDate": "1990-05-15",
    "birthTime": "14:30:00",
    "birthPlace": {"name": "æ·±åœ³", "longitude": 114.1, "latitude": 22.5}
  }'
```

---

## ğŸ“Š è¾“å‡ºç¤ºä¾‹

```json
{
  "fourPillars": {
    "year": {"fullName": "åºšåˆ", "nayin": "è·¯æ—åœŸ"},
    "month": {"fullName": "è¾›å·³", "nayin": "ç™½èœ¡é‡‘"},
    "day": {"fullName": "åºšè¾°", "nayin": "ç™½èœ¡é‡‘"},
    "hour": {"fullName": "ç™¸æœª", "nayin": "æ¨æŸ³æœ¨"}
  },
  "spirits": {
    "auspicious": ["å¤©ä¹™è´µäºº", "æ–‡æ˜Œè´µäºº"],
    "special": ["é©¿é©¬", "æ¡ƒèŠ±"]
  },
  "geju": {
    "patterns": ["å»ºç¦„æ ¼"],
    "main": "å»ºç¦„æ ¼"
  },
  "boneWeight": {
    "weight": 4.2,
    "text": "æ—©å¹´è¿é“æœªæ›¾äº¨ï¼Œè‹¥æ˜¯è¹‰è·å†ä¸å…´..."
  }
}
```

---

## ğŸ¯ ç¥ç…ç³»ç»Ÿ (21ç§)

### å‰ç¥ (15ç§)
å¤©ä¹™è´µäººã€å¤ªæè´µäººã€å¤©å¾·è´µäººã€æœˆå¾·è´µäººã€å›½å°è´µäººã€æ–‡æ˜Œè´µäººã€å°†æ˜Ÿã€å­¦å ‚ã€å¾·ç§€è´µäººã€å¤©å¾·åˆã€ç¦„ç¥ã€é‡‘èˆ†ã€å¤©åŒ»ã€æœˆå¾·åˆã€è¯é¦†

### å‡¶ç… (7ç§)  
ç¾Šåˆƒã€åŠ«ç…ã€äº¡ç¥ã€çº¢è‰³ç…ã€åæ¶å¤§è´¥ã€å‹¾ç…ã€ç»ç…

### ç‰¹æ®Š (5ç§)
é©¿é©¬ã€æ¡ƒèŠ±ã€åç›–ã€å­¤è¾°ã€å¯¡å®¿

---

## ğŸ† æ ¼å±€ç³»ç»Ÿ (10ç§)

å»ºç¦„æ ¼ã€ç¾Šåˆƒæ ¼ã€æ­£å®˜æ ¼ã€ä¸ƒæ€æ ¼ã€æ­£è´¢æ ¼ã€åè´¢æ ¼ã€æ­£å°æ ¼ã€åå°æ ¼ã€é£Ÿç¥æ ¼ã€ä¼¤å®˜æ ¼

---

## ğŸ“š æ–‡æ¡£

- [é¡¹ç›®ä¸Šä¸‹æ–‡](AGENTS.md) - å®Œæ•´é¡¹ç›®ä¿¡æ¯
- [å¼€å‘è®¡åˆ’](TODO.md) - åŠŸèƒ½å®ŒæˆçŠ¶æ€
- [APIæ–‡æ¡£](OIæ–‡æ¡£.md) - æ¥å£è§„èŒƒ
- [ä»“åº“åˆ†æ](docs/ä»“åº“åˆ†ææŠ¥å‘Š.md) - 55ä¸ªå¤–éƒ¨åº“åˆ†æ

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### å¼€å‘è§„èŒƒ
- éµå¾ª PEP 8 ä»£ç é£æ ¼
- å¤–éƒ¨åº“åªè°ƒç”¨ä¸ä¿®æ”¹
- æ•æ„Ÿä¿¡æ¯å†™å…¥ `~/.projects/fate-engine-env/.env`

---

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

---

## ğŸŒŸ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®çš„æ”¯æŒï¼š
- [lunar-python](https://github.com/6tail/lunar-python) - æ ¸å¿ƒå†æ³•åº“
- [bazi-1](https://github.com/bazi-1) - ç¥ç…æ ¼å±€å‚è€ƒ
- ä»¥åŠå…¶ä»– 53 ä¸ªå‘½ç†å¼€æºåº“

---

**Fate-Engine - è®©ä¼ ç»Ÿå‘½ç†å­¦ä¸ç°ä»£æŠ€æœ¯å®Œç¾ç»“åˆ** âœ¨
