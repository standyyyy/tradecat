# TradeCat 日志轮转配置
# ============================================================
# 使用方法:
#   1. 复制并替换路径:
#      sed "s|{{PROJECT_ROOT}}|$(pwd)|g" config/logrotate.conf > /tmp/tradecat-logrotate.conf
#      sudo logrotate -f /tmp/tradecat-logrotate.conf
#
#   2. 安装到系统 (替换 {{PROJECT_ROOT}} 和 {{USER}}):
#      sed -e "s|{{PROJECT_ROOT}}|/home/youruser/.projects/tradecat|g" \
#          -e "s|{{USER}}|youruser|g" config/logrotate.conf | sudo tee /etc/logrotate.d/tradecat
#
#   3. 测试配置:
#      sed "s|{{PROJECT_ROOT}}|$(pwd)|g" config/logrotate.conf | logrotate -d /dev/stdin
#
# 占位符说明:
#   {{PROJECT_ROOT}} - 项目根目录绝对路径
#   {{USER}}         - 运行服务的用户名
# ============================================================

# 核心服务日志 (services/)
{{PROJECT_ROOT}}/services/*/logs/*.log {
    daily                   # 每天轮转
    rotate 14               # 保留 14 天
    size 50M                # 超过 50MB 也触发轮转
    compress                # 压缩旧日志
    delaycompress           # 延迟一天压缩
    missingok               # 文件不存在不报错
    notifempty              # 空文件不轮转
    copytruncate            # 复制后截断（不重启服务）
    dateext                 # 使用日期作为后缀
    dateformat -%Y%m%d      # 日期格式
    su {{USER}} {{USER}}    # 用户权限
}

# 预览服务日志 (services-preview/)
{{PROJECT_ROOT}}/services-preview/*/logs/*.log {
    daily
    rotate 7                # 预览服务保留 7 天
    size 50M
    compress
    delaycompress
    missingok
    notifempty
    copytruncate
    dateext
    dateformat -%Y%m%d
    su {{USER}} {{USER}}
}

# 项目根目录日志 (daemon.log, alerts.log)
{{PROJECT_ROOT}}/*.log {
    daily
    rotate 7
    size 20M
    compress
    delaycompress
    missingok
    notifempty
    copytruncate
    dateext
    dateformat -%Y%m%d
    su {{USER}} {{USER}}
}
